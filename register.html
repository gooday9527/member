<!-- register.html -->

<!-- ✅【核心】完全複製登入頁面的 HTML 結構和樣式 -->
<h3 class="text-center">👋 註冊新帳號</h3>
<form id="registerForm" class="text-center mt-3" style="max-width: 400px; margin: auto;">
    <div class="mb-3 text-start">
        <label for="name" class="form-label">姓名</label>
        <input type="text" class="form-control" id="name" required />
    </div>
    <div class="mb-3 text-start">
        <label for="email" class="form-label">Email (將作為您的登入帳號)</label>
        <input type="email" class="form-control" id="email" required />
    </div>
    <div class="mb-3 text-start">
        <label for="password" class="form-label">密碼 (至少6位數)</label>
        <input type="password" class="form-control" id="password" required minlength="6" />
    </div>
    <div class="mb-3 text-start">
        <label for="confirmPassword" class="form-label">確認密碼</label>
        <input type="password" class="form-control" id="confirmPassword" required minlength="6" />
    </div>
    <button type="submit" class="btn btn-primary w-100 mb-3">確認註冊</button>
    <div class="text-center">
        <a href="#" data-section="login">已經有帳號了？返回登入</a>
    </div>
</form>

<!-- ✅ 您的核心註冊邏輯完全保留 -->
<script type="module">
    import { getApps, initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';

    const firebaseConfig = { apiKey: "AIzaSyD9Bt0HwGGwlRT3_CWFBDhjGcnYf5lCuZU", authDomain: "goodaymember.firebaseapp.com", projectId: "goodaymember", storageBucket: "goodaymember.appspot.com", messagingSenderId: "730801053598", appId: "1:730801053598:web:a2ec0dc91c78fef6bfc08f" };
    const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
    const auth = getAuth(app);

    function initializeRegisterForm() {
        const registerForm = document.getElementById('registerForm');
        if (!registerForm) return;
        registerForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) { alert("錯誤：兩次輸入的密碼不相符！"); return; }
            if (!name) { alert("錯誤：請輸入您的姓名！"); return; }

            const submitButton = registerForm.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '處理中...';

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const relayUrl = "https://script.google.com/macros/s/AKfycbzfj7nkQe1QnKiRedfYKeMBAAKVKAi17b0rEirrgzNd2AcTmgQcVvneIg5IlqQDtWaF/exec";
                const response = await fetch(relayUrl, { method: "POST", body: JSON.stringify({ action: "register", email, name }) });
                const result = await response.json();
                if (!result.success) { throw new Error(result.message || "寫入會員資料失敗"); }
                alert("✅ 註冊成功！將為您自動登入。");
                if (window.updateMainAppLoginState) { window.updateMainAppLoginState(userCredential.user.email); } else { window.location.reload(); }
            } catch (error) {
                let message = "❌ 註冊失敗：";
                if (error.code) {
                     switch (error.code) {
                        case 'auth/email-already-in-use': message += "這個 Email 已經被註冊過了。"; break;
                        case 'auth/invalid-email': message += "Email 格式不正確。"; break;
                        case 'auth/weak-password': message += "密碼強度不足，請至少設定6位數。"; break;
                        default: message += "請稍後再試。";
                    }
                } else { message += error.message; }
                alert(message);
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            }
        });
    }
    setTimeout(initializeRegisterForm, 0);
</script>

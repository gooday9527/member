<div class="recommend-wrapper mt-0">
Â  Â  Â  Â  <div class="table-controls-fixed" id="recommendControlsContainer"></div>

Â  Â  Â  Â  <div class="table-scroll-container table-responsive">
Â  Â  Â  Â  <table class="table table-bordered table-sm" id="recommendTable">
Â  Â  Â  Â  Â  Â  <thead class="table-warning"></thead>
Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="10" class="text-center p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="spinner-border text-primary" role="status">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="visually-hidden">Loading...</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </td></tr>
Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  </div>

Â  Â  Â  Â  <div id="recommendPaginationWrapper">
Â  Â  Â  Â  <div id="recommendPagination" class="d-flex justify-content-center flex-wrap"></div>
Â  Â  </div>
</div>

<script>
(function() {
Â  Â  // ==================== ã€è«‹æ³¨æ„ã€‘ä¸»è¦è¨­å®šå€ ====================
Â  Â  // âœ… å·²å°‡ Google Sheet ID æ›´æ–°ç‚ºæ‚¨æä¾›çš„æ–°ç¶²å€ ID
Â  Â  const GOOGLE_SHEET_ID = '1UPU6fkJr_IiIYqaNDg7odYrHS-o7E_JKz4kNbkJEsmI';
Â  Â  // â›”ï¸ æ‚¨å¯ä»¥å°‡ä¸æƒ³é¡¯ç¤ºåœ¨åˆ†é¡é¸å–®ä¸­çš„å·¥ä½œè¡¨åç¨±åŠ åˆ°é€™è£¡
Â  Â  const EXCLUDED_SHEETS = ["ç´€å¿µå“è³‡è¨Š", "ç‰ˆæœ¬ç´€éŒ„"];
Â  Â  // =============================================================

Â  Â  // ç‹€æ…‹è®Šæ•¸
Â  Â  let rawData = [], filteredData = [], currentPage = 1, rowsPerPage = 10;
Â  Â  let sortKey = "è‚¡è™Ÿ", sortAsc = true;
Â  Â  let headers = [];
Â  Â  let selectedSheet = '';

Â  Â  // DOM å…ƒç´ 
Â  Â  const tblHead = document.querySelector('#recommendTable thead');
Â  Â  const tblBody = document.querySelector('#recommendTable tbody');
Â  Â  const controlsContainer = document.getElementById('recommendControlsContainer');
Â  Â  const pagContainer = document.getElementById('recommendPagination');

Â  Â  // æ³¨å…¥æ§åˆ¶é … HTML
Â  Â  if (controlsContainer) {
Â  Â  Â  Â  controlsContainer.innerHTML = `
Â  Â  Â  Â  <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center w-100 mb-2 px-3 py-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center mb-2 mb-sm-0">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="mb-0 me-3 text-nowrap">ğŸŒŸ æ¨è–¦æ¸…å–®</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="sheetSelect" class="form-label mb-0 me-1 text-nowrap">åˆ†é¡:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="sheetSelect" class="form-select form-select-sm" style="width: 150px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">è¼‰å…¥ä¸­...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="searchInput" class="form-label mb-0 me-1 text-nowrap">æœå°‹:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="searchInput" class="form-control form-control-sm" style="width: 150px;" placeholder="é—œéµå­—...">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="rowsPerPageSelect" class="form-label mb-0 me-1 text-nowrap">ç­†æ•¸:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="rowsPerPageSelect" class="form-select form-select-sm" style="width: 80px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  // ç¶å®šäº‹ä»¶
Â  Â  Â  Â  document.getElementById('sheetSelect').addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  selectedSheet = e.target.value;
Â  Â  Â  Â  Â  Â  fetchData();
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('rowsPerPageSelect').addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  rowsPerPage = parseInt(e.target.value);
Â  Â  Â  Â  Â  Â  currentPage = 1;
Â  Â  Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('searchInput').addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  currentPage = 1;
Â  Â  Â  Â  Â  Â  filterData();
Â  Â  Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // ç²å– Google Sheet çš„æ‰€æœ‰å·¥ä½œè¡¨åç¨±ï¼ˆå³åˆ†é¡ï¼‰
Â  Â  function fetchSheetNames() {
Â  Â  Â  Â  const sheetSelect = document.getElementById('sheetSelect');
Â  Â  Â  Â  fetch(`https://gsheet-parser.vercel.app/api?id=${GOOGLE_SHEET_ID}`)
Â  Â  Â  Â  Â  Â  .then(res => res.ok ? res.json() : Promise.reject('ç„¡æ³•ç²å–å·¥ä½œè¡¨åˆ—è¡¨'))
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data.sheets) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetSelect.innerHTML = ''; // æ¸…ç©ºé¸é …
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.sheets.forEach(sheet => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!EXCLUDED_SHEETS.includes(sheet)) { // éæ¿¾æ‰ä¸éœ€è¦é¡¯ç¤ºçš„å·¥ä½œè¡¨
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const option = new Option(sheet, sheet);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetSelect.add(option);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedSheet = sheetSelect.value; // è¨­å®šé è¨­é¸æ“‡çš„åˆ†é¡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchData(); // ç²å–åˆ°åˆ†é¡åˆ—è¡¨å¾Œï¼Œè‡ªå‹•è¼‰å…¥ç¬¬ä¸€å€‹åˆ†é¡çš„è³‡æ–™
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('ç²å–å·¥ä½œè¡¨åç¨±å¤±æ•—ï¼š', error);
Â  Â  Â  Â  Â  Â  Â  Â  sheetSelect.innerHTML = '<option>åˆ†é¡è¼‰å…¥å¤±æ•—</option>';
Â  Â  Â  Â  Â  Â  });
Â  Â  }

Â  Â  // æ ¹æ“šé¸æ“‡çš„å·¥ä½œè¡¨ï¼ˆåˆ†é¡ï¼‰ç²å–è³‡æ–™
Â  Â  function fetchData() {
Â  Â  Â  Â  if (!selectedSheet) return;
Â  Â  Â  Â  tblBody.innerHTML = `<tr><td colspan="10" class="text-center p-4"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>`;

Â  Â  Â  Â  fetch(`https://opensheet.elk.sh/${GOOGLE_SHEET_ID}/${selectedSheet}`)
Â  Â  Â  Â  Â  Â  .then(res => res.ok ? res.json() : Promise.reject('Network response was not ok.'))
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!data || data.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rawData = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tblHead.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tblBody.innerHTML = '<tr><td colspan="10" class="text-center p-4">é€™å€‹åˆ†é¡ç›®å‰æ²’æœ‰è³‡æ–™</td></tr>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  rawData = data;
Â  Â  Â  Â  Â  Â  Â  Â  headers = Object.keys(rawData[0]);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  currentPage = 1;
Â  Â  Â  Â  Â  Â  Â  Â  sortKey = headers.includes("è‚¡è™Ÿ") ? "è‚¡è™Ÿ" : headers[0];
Â  Â  Â  Â  Â  Â  Â  Â  sortAsc = true;
Â  Â  Â  Â  Â  Â  Â  Â  renderHeader();
Â  Â  Â  Â  Â  Â  Â  Â  sortData();
Â  Â  Â  Â  Â  Â  Â  Â  filterData();
Â  Â  Â  Â  Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(`è¼‰å…¥ ${selectedSheet} è³‡æ–™éŒ¯èª¤ï¼š`, error);
Â  Â  Â  Â  Â  Â  Â  Â  tblBody.innerHTML = '<tr><td colspan="10" class="text-danger text-center">è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>';
Â  Â  Â  Â  Â  Â  });
Â  Â  }

Â  Â  // æ’åºè³‡æ–™
Â  Â  function sortData() {
Â  Â  Â  Â  const isPureNumeric = (s) => /^-?\d+(\.\d+)?$/.test(String(s).trim());
Â  Â  Â  Â  rawData.sort((a, b) => {
Â  Â  Â  Â  Â  Â  const valA = a[sortKey] || '';
Â  Â  Â  Â  Â  Â  const valB = b[sortKey] || '';
Â  Â  Â  Â  Â  Â  if (isPureNumeric(valA) && isPureNumeric(valB)) {
Â  Â  Â  Â  Â  Â  Â  Â  return sortAsc ? Number(valA) - Number(valB) : Number(valB) - Number(valA);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  return sortAsc ? String(valA).localeCompare(String(valB), 'zh-Hant') : String(valB).localeCompare(String(valA), 'zh-Hant');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
Â  Â Â 
Â  Â  // æ’åºè¡¨æ ¼
Â  Â  function sortTable(key) {
Â  Â  Â  Â  sortAsc = (sortKey === key) ? !sortAsc : true;
Â  Â  Â  Â  sortKey = key;
Â  Â  Â  Â  sortData();
Â  Â  Â  Â  filterData();
Â  Â  Â  Â  renderTable();
Â  Â  }

Â  Â  // éæ¿¾è³‡æ–™
Â  Â  function filterData() {
Â  Â  Â  Â  const searchInput = document.getElementById('searchInput');
Â  Â  Â  Â  if (!searchInput) {
Â  Â  Â  Â  Â  Â  filteredData = [...rawData];
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const keyword = searchInput.value.trim().toLowerCase();
Â  Â  Â  Â  filteredData = keyword ? rawData.filter(row => headers.some(h => String(row[h] || '').toLowerCase().includes(keyword))) : [...rawData];
Â  Â  }

Â  Â  // æ¸²æŸ“è¡¨é ­
Â  Â  function renderHeader() {
Â  Â  Â  Â  tblHead.innerHTML = `<tr>${headers.map(h => `<th class="sortable" data-key="${h}" style="cursor: pointer; white-space: nowrap;">${h} <i class="fa-solid fa-sort sort-indicator"></i></th>`).join('')}</tr>`;
Â  Â  Â  Â  tblHead.querySelectorAll('th.sortable').forEach(th => {
Â  Â  Â  Â  Â  Â  th.addEventListener('click', () => sortTable(th.dataset.key));
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // æ¸²æŸ“è¡¨æ ¼
Â  Â  function renderTable() {
Â  Â  Â  Â  // æ›´æ–°æ’åºåœ–ç¤º
Â  Â  Â  Â  tblHead.querySelectorAll('.sort-indicator').forEach(icon => {
Â  Â  Â  Â  Â  Â  icon.className = 'fa-solid fa-sort sort-indicator';
Â  Â  Â  Â  Â  Â  icon.style.color = '#aaa';
Â  Â  Â  Â  });
Â  Â  Â  Â  const activeIcon = tblHead.querySelector(`th[data-key="${sortKey}"] .sort-indicator`);
Â  Â  Â  Â  if (activeIcon) {
Â  Â  Â  Â  Â  Â  activeIcon.className = sortAsc ? 'fa-solid fa-sort-up sort-indicator' : 'fa-solid fa-sort-down sort-indicator';
Â  Â  Â  Â  Â  Â  activeIcon.style.color = 'black';
Â  Â  Â  Â  }

Â  Â  Â  Â  // æ¸²æŸ“è¡¨æ ¼å…§å®¹
Â  Â  Â  Â  const start = (currentPage - 1) * rowsPerPage;
Â  Â  Â  Â  const end = start + rowsPerPage;
Â  Â  Â  Â  const pageData = filteredData.slice(start, end);
Â  Â  Â  Â  tblBody.innerHTML = pageData.length > 0 ? pageData.map(row => `<tr>${headers.map(k => `<td>${row[k] || ''}</td>`).join('')}</tr>`).join('') : `<tr><td colspan="${headers.length}" class="text-center p-4">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</td></tr>`;
Â  Â  Â  Â  renderPagination();
Â  Â  }

Â  Â  // æ¸²æŸ“åˆ†é 
Â  Â  function renderPagination() {
Â  Â  Â  Â  const totalPages = Math.ceil(filteredData.length / rowsPerPage) || 1;
Â  Â  Â  Â  if (totalPages <= 1) {
Â  Â  Â  Â  Â  Â  pagContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  let pageButtons = [];
Â  Â  Â  Â  pageButtons.push(`<button class="btn btn-sm btn-outline-secondary me-1" ${currentPage === 1 ? 'disabled' : ''} onclick="window.recommendTable.changePage(-1)">ä¸Šé </button>`);
Â  Â  Â  Â  let startPage = Math.max(1, currentPage - 2);
Â  Â  Â  Â  let endPage = Math.min(totalPages, currentPage + 2);

Â  Â  Â  Â  if (startPage > 1) pageButtons.push(`<button class="btn btn-sm btn-outline-primary me-1" onclick="window.recommendTable.goToPage(1)">1</button>`);
Â  Â  Â  Â  if (startPage > 2) pageButtons.push(`<span class="align-self-center me-1">...</span>`);
Â  Â  Â  Â  for (let i = startPage; i <= endPage; i++) {
Â  Â  Â  Â  Â  Â  pageButtons.push(`<button class="btn btn-sm me-1 ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}" onclick="window.recommendTable.goToPage(${i})">${i}</button>`);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (endPage < totalPages - 1) pageButtons.push(`<span class="align-self-center me-1">...</span>`);
Â  Â  Â  Â  if (endPage < totalPages) pageButtons.push(`<button class="btn btn-sm btn-outline-primary me-1" onclick="window.recommendTable.goToPage(${totalPages})">${totalPages}</button>`);
Â  Â  Â  Â  pageButtons.push(`<button class="btn btn-sm btn-outline-secondary" ${currentPage === totalPages ? 'disabled' : ''} onclick="window.recommendTable.changePage(1)">ä¸‹é </button>`);
Â  Â  Â  Â  pagContainer.innerHTML = pageButtons.join('');
Â  Â  }
Â  Â Â 
Â  Â  // å°‡åˆ†é å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸ
Â  Â  window.recommendTable = {
Â  Â  Â  Â  changePage: (offset) => {Â 
Â  Â  Â  Â  Â  Â  const totalPages = Math.ceil(filteredData.length / rowsPerPage) || 1;
Â  Â  Â  Â  Â  Â  currentPage = Math.min(Math.max(1, currentPage + offset), totalPages);
Â  Â  Â  Â  Â  Â  renderTable();Â 
Â  Â  Â  Â  },
Â  Â  Â  Â  goToPage: (page) => {Â 
Â  Â  Â  Â  Â  Â  currentPage = page;Â 
Â  Â  Â  Â  Â  Â  renderTable();Â 
Â  Â  Â  Â  }
Â  Â  };
Â  Â Â 
Â  Â  // åˆå§‹åŒ–
Â  Â  fetchSheetNames();

})();
</script>

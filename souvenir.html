<!-- souvenir.html -->
<h3 class="text-center">ğŸ ç´€å¿µå“</h3>
<div class="souvenir-wrapper mt-2">
    <div class="table-controls-fixed d-flex flex-wrap align-items-center gap-2" id="souvenirControlsContainer"></div>
    <div class="table-scroll-container table-responsive">
        <table class="table table-bordered table-sm" id="souvenirTable">
            <thead class="table-warning"></thead>
            <tbody></tbody>
        </table>
    </div>
    <div id="souvenirPaginationWrapper">
        <div id="souvenirPagination" class="d-flex justify-content-center flex-wrap"></div>
    </div>
</div>
<!-- ç›¸é—œ JavaScript é‚è¼¯å°‡æœƒå¾ index.html ç§»åˆ°é€™è£¡ -->
<script>
    // é€™äº›å‡½æ•¸åŸæœ¬åœ¨ index.html çš„ <script type="module"> è£¡é¢
    // ç¾åœ¨å®ƒå€‘å°‡åœ¨é€™å€‹é é¢è¼‰å…¥æ™‚åŸ·è¡Œ

    // ç¢ºä¿é€™äº›å‡½æ•¸æ˜¯å…¨å±€å¯è¨ªå•çš„ï¼Œæˆ–è€…åœ¨é€™å€‹è…³æœ¬å…§è¢«æ­£ç¢ºèª¿ç”¨
    // ç”±æ–¼å®ƒå€‘æœƒè¢«å‹•æ…‹è¼‰å…¥ï¼Œç›´æ¥å¯«åœ¨é€™è£¡å³å¯ï¼Œå®ƒå€‘æœƒåœ¨è¼‰å…¥æ™‚è¢«è§£æå’ŒåŸ·è¡Œ
    
    // ç´€å¿µå“è¡¨æ ¼è¼‰å…¥é‚è¼¯
    function loadSouvenirDataWithoutDataTables() {
        // å…ˆæ¸…ç©ºæ§åˆ¶å€é¿å…é‡è¤‡
        document.getElementById("souvenirControlsContainer").innerHTML = "";

        fetch('https://opensheet.elk.sh/1z4SqcpGbhVtb5I6hQZ5aI9PQTNt2_64-ZFdc0_cV3kE/ç´€å¿µå“è³‡è¨Š')
            .then(res => res.json())
            .then(data => {
                const tableElement = document.getElementById('souvenirTable');
                const tableHead = tableElement.querySelector('thead');
                const tableBody = tableElement.querySelector('tbody');

                // æ’å…¥æœå°‹èˆ‡ç­†æ•¸æ§åˆ¶å…ƒä»¶
                const controls = document.createElement('div');
                controls.className = 'd-flex justify-content-between align-items-center mb-1 flex-wrap';
                controls.innerHTML = `
                    <div class="mb-0">
                        <label for="rowsPerPageSelect" class="me-1">ç­†æ•¸ï¼š</label>
                        <select id="rowsPerPageSelect" class="form-select form-select-sm d-inline-block me-3" style="width: 70px;">
                            <option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option>
                        </select>
                    </div><div class="mb-0">
                        <label for="searchInput" class="me-1">æœå°‹ï¼š</label>
                        <input type="text" id="searchInput" class="form-control form-control-sm d-inline-block" style="width: 100px;" placeholder="è¼¸å…¥é—œéµå­—">
                    </div>
                `;
                const controlsContainer = document.getElementById('souvenirControlsContainer');
                if (controlsContainer) controlsContainer.appendChild(controls);

                if (!data || data.length === 0) {
                    tableHead.innerHTML = ''; tableBody.innerHTML = '<tr><td colspan="100%">æ²’æœ‰å¯ç”¨çš„è³‡æ–™</td></tr>'; return;
                }

                const headers = Object.keys(data[0]);
                let currentPage = 1; let rowsPerPage = 10; let sortKey = "è‚¡è™Ÿ"; let sortAsc = true;
                let sortedData = [...data]; let filteredData = [...data];

                tableHead.innerHTML = `<tr>${headers.map(h => `<th class="sortable" data-key="${h}">${h} â–²</th>`).join('')}</tr>`;
                headers.forEach(h => {
                    const th = tableHead.querySelector(`th[data-key="${h}"]`);
                    if (th) { th.style.cursor = 'pointer'; th.addEventListener('click', () => sortTable(h)); }
                });

                document.getElementById('searchInput').addEventListener('input', (e) => {
                    const keyword = e.target.value.trim().toLowerCase();
                    filteredData = sortedData.filter(row => headers.some(h => (row[h] || '').toLowerCase().includes(keyword)));
                    currentPage = 1; renderTable();
                });

                document.getElementById('rowsPerPageSelect').addEventListener('change', (e) => {
                    rowsPerPage = parseInt(e.target.value); currentPage = 1; renderTable();
                });

                let firstLoad = true;
                function sortTable(key) {
                    if (firstLoad) { firstLoad = false; sortAsc = true; } else { sortAsc = (sortKey === key) ? !sortAsc : true; }
                    sortKey = key;
                    sortedData.sort((a, b) => {
                        const valA = a[key] || ''; const valB = b[key] || ''; const isNumber = !isNaN(valA) && !isNaN(valB);
                        return isNumber ? (sortAsc ? Number(valA) - Number(valB) : Number(valB) - Number(valA)) : (sortAsc ? valA.localeCompare(valB, 'zh-Hant') : valB.localeCompare(valA, 'zh-Hant'));
                    });
                    const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
                    filteredData = keyword ? sortedData.filter(row => headers.some(h => (row[h] || '').toLowerCase().includes(keyword))) : [...sortedData];
                    currentPage = 1; renderTable();
                }

                function renderTable() {
                    const start = (currentPage - 1) * rowsPerPage; const end = start + rowsPerPage;
                    const pageData = filteredData.slice(start, end);
                    tableBody.innerHTML = pageData.map(row => `<tr>${headers.map(k => `<td>${row[k] || ''}</td>`).join('')}</tr>`).join('');
                    renderPagination();
                }

                function renderPagination() {
                    const totalPages = Math.ceil(filteredData.length / rowsPerPage); const maxVisible = 3; const pageButtons = [];
                    pageButtons.push(`<button class="btn btn-sm btn-outline-secondary me-1" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(-1)">ä¸Šé </button>`);
                    let start = currentPage; let end = Math.min(totalPages, currentPage + 2);
                    if (end - start < maxVisible - 1) start = Math.max(1, end - maxVisible + 1);
                    if (start > 1) { pageButtons.push(`<button class="btn btn-sm btn-outline-primary me-1" onclick="goToPage(1)">1</button>`); if (start > 2) pageButtons.push(`<span class="me-1">...</span>`); }
                    for (let i = start; i <= end; i++) { pageButtons.push(`<button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'} me-1" onclick="goToPage(${i})">${i}</button>`); }
                    if (end < totalPages) { if (end < totalPages - 1) pageButtons.push(`<span class="me-1">...</span>`); pageButtons.push(`<button class="btn btn-sm btn-outline-primary me-1" onclick="goToPage(${totalPages})">${totalPages}</button>`); }
                    pageButtons.push(`<button class="btn btn-sm btn-outline-secondary" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(1)">ä¸‹é </button>`);
                    document.getElementById('souvenirPagination').innerHTML = pageButtons.join('');
                }

                // å°‡é€™äº›å‡½æ•¸æ›è¼‰åˆ° windowï¼Œä»¥ä¾¿ onclick å±¬æ€§å¯ä»¥æ‰¾åˆ°å®ƒå€‘
                window.changePage = function(offset) { currentPage += offset; renderTable(); };
                window.goToPage = function(page) { currentPage = page; renderTable(); };

                sortAsc = true; sortTable(sortKey);
            })
            .catch(error => { console.error('è¼‰å…¥ç´€å¿µå“è³‡æ–™éŒ¯èª¤ï¼š', error); });
    }

// å› ç‚ºé€™æ®µ script æ˜¯åœ¨è¢«å‹•æ…‹è¼‰å…¥å¾Œç«‹å³åŸ·è¡Œï¼Œæ‰€ä»¥ç›´æ¥å‘¼å«ä¸»å‡½æ•¸å³å¯
loadSouvenirDataWithoutDataTables();
</script>

<div class="recommend-wrapper">

    <h3 class="text-center">ğŸŒŸ æ¨è–¦æ¸…å–®</h3>

    <div class="d-flex align-items-center gap-2 recommend-controls">
        <label for="recommendSheet" class="form-label mb-0">é¸æ“‡åˆ†é¡ï¼š</label>
        <select id="recommendSheet" class="form-select form-select-sm" style="max-width: 200px;">
            <option value="æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰">æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰</option>
            <option value="é«˜cpæ¨è–¦">é«˜cpæ¨è–¦</option>
            <option value="ç¦®åˆ¸é¡">ç¦®åˆ¸é¡</option>
            <option value="å°è³‡æ—">å°è³‡æ—</option>
            <option value="å…¥é–€çµ„">å…¥é–€çµ„</option>
        </select>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-sm" id="recommendTable">
            <thead class="table-warning"></thead>
            <tbody></tbody>
        </table>
    </div>

</div> 
<script>
    function showSkeletonLoader() {
        const tableElement = document.getElementById('recommendTable');
        if (!tableElement) return;

        const thead = tableElement.querySelector('thead');
        const tbody = tableElement.querySelector('tbody');

        // éª¨æ¶å±çš„è¡¨é ­ (æ¨¡æ“¬æœ€çµ‚æ¬„ä½æ•¸é‡)
        thead.innerHTML = `
            <tr>
                <th><div class="skeleton-line"></div></th>
                <th><div class="skeleton-line"></div></th>
                <th><div class="skeleton-line"></div></th>
                <th><div class="skeleton-line"></div></th>
            </tr>
        `;

        // éª¨æ¶å±çš„å…§å®¹ (æ¨¡æ“¬å¹¾è¡Œè³‡æ–™)
        let skeletonRows = '';
        for (let i = 0; i < 5; i++) { // é¡¯ç¤º 5 è¡Œéª¨æ¶
            skeletonRows += `
                <tr>
                    <td><div class="skeleton-line"></div></td>
                    <td><div class="skeleton-line"></div></td>
                    <td><div class="skeleton-line"></div></td>
                    <td><div class="skeleton-line"></div></td>
                </tr>
            `;
        }
        tbody.innerHTML = skeletonRows;
    }

    function loadRecommend(sheetName) {
        // âœ… æ­¥é©Ÿ 1: ç«‹åˆ»é¡¯ç¤ºéª¨æ¶å±
        showSkeletonLoader();
        
        const url = `https://opensheet.elk.sh/1WNSOI3l4AVk2h1kY0qj7xu4-9YdU_2fEj8xUf7lUSZk/${encodeURIComponent(sheetName)}`;
        
        // âœ… æ­¥é©Ÿ 2: é–‹å§‹éåŒæ­¥è¼‰å…¥è³‡æ–™
        fetch(url)
            .then(res => res.ok ? res.json() : Promise.reject(res.status))
            .then(data => {
                const tableElement = document.getElementById('recommendTable');
                if (!tableElement) return;
                const thead = tableElement.querySelector('thead');
                const tbody = tableElement.querySelector('tbody');
                
                // âœ… æ­¥é©Ÿ 3: è³‡æ–™å›ä¾†å¾Œï¼Œæ¸…é™¤éª¨æ¶å±ï¼Œå¡«å…¥çœŸå¯¦å…§å®¹
                thead.innerHTML = '';
                tbody.innerHTML = ''; 

                if (data && data.length > 0) {
                    const headers = Object.keys(data[0]);
                    thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
                    tbody.innerHTML = data.map(row => `<tr>${headers.map(k => `<td>${row[k]|| ''}</td>`).join('')}</tr>`).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="100%">æ²’æœ‰å¯ç”¨çš„è³‡æ–™</td></tr>';
                }
            })
            .catch(error => {
                console.error('è¼‰å…¥æ¨è–¦æ¸…å–®è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                const tbody = document.getElementById('recommendTable')?.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = `<tr><td colspan="100%" class="text-danger">è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚</td></tr>`;
                }
            });
    }

    function initializeRecommendPage() {
        const recommendSheetSelect = document.getElementById('recommendSheet');
        if (recommendSheetSelect) {
            recommendSheetSelect.addEventListener('change', function () {
                loadRecommend(this.value);
            });
            loadRecommend(recommendSheetSelect.value);
        }
    }

    setTimeout(initializeRecommendPage, 0);
</script>

<!-- login.html -->
<h3 class="text-center">🔐 登入</h3>
<form id="loginForm" class="text-center mt-3" style="max-width: 400px; margin: auto;">
    <div class="mb-3">
        <input type="email" id="loginEmail" class="form-control" placeholder="Email" required />
    </div>
    <div class="mb-3">
        <input type="password" id="loginPassword" class="form-control" placeholder="密碼" required />
    </div>
    <button type="submit" class="btn btn-warning w-100 mb-3">登入</button>

    <div class="d-flex justify-content-between gap-2">
        <a href="reset-password.html" class="btn btn-danger w-100">忘記密碼？</a>
        <a href="register.html" class="btn btn-primary w-100">註冊新帳號</a>
    </div>
</form>
<!-- 相關 JavaScript 邏輯將會從 index.html 移到這裡 -->
<script type="module">
    // 這裡需要重新初始化 Firebase，因為這個 HTML 是獨立載入的
    // 並確保獲取 auth 實例
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';

    const firebaseConfig = {
        apiKey: "AIzaSyD9Bt0HwGGwlRT3_CWFBDhjGcnYf5lCuZU",
        authDomain: "goodaymember.firebaseapp.com",
        projectId: "goodaymember",
        storageBucket: "goodaymember.appspot.com",
        messagingSenderId: "730801053598",
        appId: "1:730801053598:web:a2ec0dc91c78fef6bfc08f",
        measurementId: "G-J3Z7YTHJ9P"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    document.addEventListener("DOMContentLoaded", function() {
        // 登入表單提交事件處理
        document.getElementById("loginForm")?.addEventListener("submit", function (e) {
            e.preventDefault();
            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("登入成功", user.email);
                    // 呼叫 index.html 中的全局函數來更新主頁面狀態
                    if (window.updateMainAppLoginState) {
                        window.updateMainAppLoginState(user.email);
                    }
                    alert("✅ 登入成功！");
                })
                .catch((error) => {
                    console.error("登入失敗", error);
                    alert("登入失敗：" + error.message);
                });
        });
    });
</script>

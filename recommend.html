<div class="recommend-wrapper">

    <h3 class="text-center">🌟 推薦清單</h3>

    <div class="d-flex align-items-center gap-2 recommend-controls">
        <label for="recommendSheet" class="form-label mb-0">選擇分類：</label>
        <select id="recommendSheet" class="form-select form-select-sm" style="max-width: 200px;">
            <option value="我全都要（不需證件）">我全都要（不需證件）</option>
            <option value="高cp推薦">高cp推薦</option>
            <option value="禮券類">禮券類</option>
            <option value="小資族">小資族</option>
            <option value="入門組">入門組</option>
        </select>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-sm" id="recommendTable">
            <thead class="table-warning"></thead>
            <tbody></tbody>
        </table>
    </div>

</div> 
<script>
    function loadRecommend(sheetName) {
        const tableContainer = document.querySelector('.recommend-wrapper .table-responsive');
        const tableElement = document.getElementById('recommendTable');
        if (!tableContainer || !tableElement) return;

        // ✅ 步驟 1: 在開始載入時，為表格容器加上 'is-loading' class
        // 這個 class 會觸發 CSS 來隱藏表格並顯示「載入中」提示
        tableContainer.classList.add('is-loading');
        
        const url = `https://opensheet.elk.sh/1WNSOI3l4AVk2h1kY0qj7xu4-9YdU_2fEj8xUf7lUSZk/${encodeURIComponent(sheetName)}`;
        
        fetch(url)
            .then(res => res.ok ? res.json() : Promise.reject(res.status))
            .then(data => {
                const thead = tableElement.querySelector('thead');
                const tbody = tableElement.querySelector('tbody');
                
                thead.innerHTML = '';
                tbody.innerHTML = ''; 

                if (data && data.length > 0) {
                    const headers = Object.keys(data[0]);
                    thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
                    tbody.innerHTML = data.map(row => `<tr>${headers.map(k => `<td>${row[k]|| ''}</td>`).join('')}</tr>`).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="100%">沒有可用的資料</td></tr>';
                }
            })
            .catch(error => {
                console.error('載入推薦清單資料時發生錯誤:', error);
                const tbody = tableElement.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = `<tr><td colspan="100%" class="text-danger">資料載入失敗，請檢查網路連線或稍後再試。</td></tr>`;
                }
            })
            .finally(() => {
                // ✅ 步驟 2: 無論成功或失敗，都移除 'is-loading' class
                // CSS 會自動將表格顯示出來
                tableContainer.classList.remove('is-loading');
            });
    }

    function initializeRecommendPage() {
        const recommendSheetSelect = document.getElementById('recommendSheet');
        if (recommendSheetSelect) {
            recommendSheetSelect.addEventListener('change', function () {
                loadRecommend(this.value);
            });
            loadRecommend(recommendSheetSelect.value);
        }
    }

    setTimeout(initializeRecommendPage, 0);
</script>

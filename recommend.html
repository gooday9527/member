<!-- recommend.html -->
<h3 class="text-center">ğŸŒŸ æ¨è–¦æ¸…å–®</h3>
<div class="mb-3 d-flex align-items-center gap-2">
    <label for="recommendSheet" class="form-label mb-0">é¸æ“‡åˆ†é¡ï¼š</label>
    <select id="recommendSheet" class="form-select form-select-sm" style="max-width: 200px;">
        <option value="æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰">æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰</option>
        <option value="é«˜cpæ¨è–¦">é«˜cpæ¨è–¦</option>
        <option value="ç¦®åˆ¸é¡">ç¦®åˆ¸é¡</option>
        <option value="å°è³‡æ—">å°è³‡æ—</option>
        <option value="å…¥é–€çµ„">å…¥é–€çµ„</option>
    </select>
</div>
<div class="mt-3 table-responsive">
    <table class="table table-bordered table-sm" id="recommendTable">
        <thead class="table-warning"></thead>
        <tbody></tbody>
    </table>
</div>
<!-- ç›¸é—œ JavaScript é‚è¼¯å°‡æœƒå¾ index.html ç§»åˆ°é€™è£¡ -->
<script>
    // æ¨è–¦æ¸…å–®è¼‰å…¥é‚è¼¯
    function loadRecommend(sheetName) {
        const url = `https://opensheet.elk.sh/1WNSOI3l4AVk2h1kY0qj7xu4-9YdU_2fEj8xUf7lUSZk/${encodeURIComponent(sheetName)}`;
        fetch(url)
            .then(res => res.json())
            .then(data => {
                const tableElement = document.getElementById('recommendTable');
                if (tableElement) {
                    tableElement.querySelector('thead').innerHTML = ''; tableElement.querySelector('tbody').innerHTML = '';
                    if (data && data.length > 0) {
                        const headers = Object.keys(data[0]);
                        const thead = headers.map(h => `<th>${h}</th>`).join('');
                        const tbody = data.map(row => `<tr>${headers.map(k => `<td>${row[k]|| ''}</td>`).join('')}</tr>`).join('');
                        tableElement.querySelector('thead').innerHTML = `<tr>${thead}</tr>`;
                        tableElement.querySelector('tbody').innerHTML = tbody;
                    } else {
                        tableElement.querySelector('thead').innerHTML = ''; tableElement.querySelector('tbody').innerHTML = '<tr><td colspan="100%">æ²’æœ‰å¯ç”¨çš„è³‡æ–™</td></tr>';
                    }
                }
            })
            .catch(error => console.error('è¼‰å…¥æ¨è–¦æ¸…å–®è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error));
    }

  // âœ… 1. å°‡æ‚¨çš„é‚è¼¯åŒ…è£åˆ°ä¸€å€‹å•Ÿå‹•å‡½æ•¸ä¸­
function initializeRecommendPage() {
    const recommendSheetSelect = document.getElementById('recommendSheet');

    // ç¢ºä¿å…ƒç´ çœŸçš„å­˜åœ¨
    if (recommendSheetSelect) {
        // ç¶å®šä¸‹æ‹‰é¸å–®çš„è®Šæ›´äº‹ä»¶
        recommendSheetSelect.addEventListener('change', function () {
            loadRecommend(this.value);
        });

        // é è¨­è¼‰å…¥ç¬¬ä¸€å€‹é …ç›®
        // å„ªåŒ–ï¼šç›´æ¥è®€å–é¸å–®çš„ç•¶å‰å€¼ï¼Œè€Œä¸æ˜¯å¯«æ­»ä¸€å€‹å€¼ï¼Œæ›´æœ‰å½ˆæ€§
        loadRecommend(recommendSheetSelect.value || 'æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰'); 
    
    } else {
        // å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œåœ¨ä¸»æ§å°å°å‡ºéŒ¯èª¤ï¼Œæ–¹ä¾¿é™¤éŒ¯
        console.error("éŒ¯èª¤ï¼šåœ¨ recommend.html ä¸­æ‰¾ä¸åˆ° ID ç‚º recommendSheet çš„å…ƒç´ ï¼");
    }
}

// âœ… 2. ä½¿ç”¨ setTimeout å‘¼å«é€™å€‹å•Ÿå‹•å‡½æ•¸ï¼Œè§£æ±ºæ™‚åºå•é¡Œ
setTimeout(initializeRecommendPage, 0);
    });
</script>

<div class="recommend-wrapper">

    <h3 class="text-center">ğŸŒŸ æ¨è–¦æ¸…å–®</h3>

    <div class="d-flex align-items-center gap-2 recommend-controls">
        <label for="recommendSheet" class="form-label mb-0">é¸æ“‡åˆ†é¡ï¼š</label>
        <select id="recommendSheet" class="form-select form-select-sm" style="max-width: 200px;">
            <option value="æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰">æˆ‘å…¨éƒ½è¦ï¼ˆä¸éœ€è­‰ä»¶ï¼‰</option>
            <option value="é«˜cpæ¨è–¦">é«˜cpæ¨è–¦</option>
            <option value="ç¦®åˆ¸é¡">ç¦®åˆ¸é¡</option>
            <option value="å°è³‡æ—">å°è³‡æ—</option>
            <option value="å…¥é–€çµ„">å…¥é–€çµ„</option>
        </select>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-sm" id="recommendTable">
            <thead class="table-warning"></thead>
            <tbody></tbody>
        </table>
    </div>

</div> 
<script>
    function loadRecommend(sheetName) {
        const tableContainer = document.querySelector('.recommend-wrapper .table-responsive');
        const tableElement = document.getElementById('recommendTable');
        if (!tableContainer || !tableElement) return;

        // âœ… æ­¥é©Ÿ 1: åœ¨é–‹å§‹è¼‰å…¥æ™‚ï¼Œç‚ºè¡¨æ ¼å®¹å™¨åŠ ä¸Š 'is-loading' class
        // é€™å€‹ class æœƒè§¸ç™¼ CSS ä¾†éš±è—è¡¨æ ¼ä¸¦é¡¯ç¤ºã€Œè¼‰å…¥ä¸­ã€æç¤º
        tableContainer.classList.add('is-loading');
        
        const url = `https://opensheet.elk.sh/1WNSOI3l4AVk2h1kY0qj7xu4-9YdU_2fEj8xUf7lUSZk/${encodeURIComponent(sheetName)}`;
        
        fetch(url)
            .then(res => res.ok ? res.json() : Promise.reject(res.status))
            .then(data => {
                const thead = tableElement.querySelector('thead');
                const tbody = tableElement.querySelector('tbody');
                
                thead.innerHTML = '';
                tbody.innerHTML = ''; 

                if (data && data.length > 0) {
                    const headers = Object.keys(data[0]);
                    thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
                    tbody.innerHTML = data.map(row => `<tr>${headers.map(k => `<td>${row[k]|| ''}</td>`).join('')}</tr>`).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="100%">æ²’æœ‰å¯ç”¨çš„è³‡æ–™</td></tr>';
                }
            })
            .catch(error => {
                console.error('è¼‰å…¥æ¨è–¦æ¸…å–®è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                const tbody = tableElement.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = `<tr><td colspan="100%" class="text-danger">è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚</td></tr>`;
                }
            })
            .finally(() => {
                // âœ… æ­¥é©Ÿ 2: ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½ç§»é™¤ 'is-loading' class
                // CSS æœƒè‡ªå‹•å°‡è¡¨æ ¼é¡¯ç¤ºå‡ºä¾†
                tableContainer.classList.remove('is-loading');
            });
    }

    function initializeRecommendPage() {
        const recommendSheetSelect = document.getElementById('recommendSheet');
        if (recommendSheetSelect) {
            recommendSheetSelect.addEventListener('change', function () {
                loadRecommend(this.value);
            });
            loadRecommend(recommendSheetSelect.value);
        }
    }

    setTimeout(initializeRecommendPage, 0);
</script>
